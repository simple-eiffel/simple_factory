note
	description: "Exploit and regression tests for documented bug fixes"
	author: "Larry Rix"
	date: "$Date$"
	revision: "$Revision$"

class
	TEST_EXPLOITS

create
	make

feature {NONE} -- Initialization

	make
			-- Run exploit tests
		do
			print ("Running exploit/regression tests...%N%N")
			run_all_tests
			print ("%N========================%N")
			print ("Exploit/Regression Results: " + pass_count.out + " passed, " + fail_count.out + " failed%N")
		end

feature -- Test Execution

	run_all_tests
			-- Run all exploit/regression test cases
		do
			-- Regression test for BUG-001 (V01) - now FIXED
			test_regression_v01_aliased_type_name
			-- Additional test for exact type name (always worked)
			test_exact_type_name_still_works
		end

feature -- Regression Tests (BUG-001 V01)

	test_regression_v01_aliased_type_name
			-- REGRESSION TEST: new_instance_from_string works with aliased type names
			-- This test verifies the fix for BUG-001 (V01).
			-- Previously, calling factory.new_instance_from_string("my_alias") would
			-- trigger a postcondition violation because matches_specification compared
			-- the literal type name with the alias.
			-- FIX: matches_specification now compares stripped type names against
			-- the registered TYPE's stripped name.
		local
			l_factory: SIMPLE_TYPE_FACTORY [TEST_OBJECT]
			l_obj: TEST_OBJECT
		do
			print ("  test_regression_v01_aliased_type_name: ")
			create l_factory.make
			-- Register with an ALIASED name (different from "TEST_OBJECT")
			l_factory.register_type ("my_alias", {TEST_OBJECT})
			-- This call should now work without postcondition violation
			l_obj := l_factory.new_instance_from_string ("my_alias")
			-- Verify the object was created correctly
			if l_obj /= Void and then l_obj.is_in_default_state then
				report_pass
			else
				report_fail ("object not created or not in default state")
			end
		end

	test_exact_type_name_still_works
			-- Verify that using exact type names still works after the fix
		local
			l_factory: SIMPLE_TYPE_FACTORY [TEST_OBJECT]
			l_obj: TEST_OBJECT
		do
			print ("  test_exact_type_name_still_works: ")
			create l_factory.make
			-- Register with exact type name
			l_factory.register_type ("TEST_OBJECT", {TEST_OBJECT})
			-- This should work (always did)
			l_obj := l_factory.new_instance_from_string ("TEST_OBJECT")
			if l_obj /= Void and then l_obj.is_in_default_state then
				report_pass
			else
				report_fail ("object not created or not in default state")
			end
		end

feature -- Test Results

	pass_count: INTEGER
	fail_count: INTEGER

feature {NONE} -- Test Infrastructure

	report_pass
		do
			pass_count := pass_count + 1
			print ("PASS%N")
		end

	report_fail (a_reason: STRING)
		do
			fail_count := fail_count + 1
			print ("FAIL - " + a_reason + "%N")
		end

end
